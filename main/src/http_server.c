#include "http_server.h"


static char ssid[64] = "";
static char access_key[64] = "bmstu";
static char password[64] = "";
static httpd_handle_t server = NULL;
static const char *TAG = "HTTP_SERVER";

const char index_html[] = {
    0x3C, 0x68, 0x74, 0x6D, 0x6C, 0x3E, 0x0D, 0x0A, 0x3C, 0x68, 0x65, 0x61, 0x64, 0x3E, 0x0D,
    0x0A, 0x20, 0x20, 0x20, 0x20, 0x3C, 0x74, 0x69, 0x74, 0x6C, 0x65, 0x3E, 0x45, 0x53, 0x50,
    0x33, 0x32, 0x3C, 0x2F, 0x74, 0x69, 0x74, 0x6C, 0x65, 0x3E, 0x0D, 0x0A, 0x3C, 0x2F, 0x68,
    0x65, 0x61, 0x64, 0x3E, 0x0D, 0x0A, 0x3C, 0x62, 0x6F, 0x64, 0x79, 0x3E, 0x0D, 0x0A, 0x20,
    0x20, 0x20, 0x20, 0x3C, 0x66, 0x6F, 0x72, 0x6D, 0x20, 0x6F, 0x6E, 0x73, 0x75, 0x62, 0x6D,
    0x69, 0x74, 0x3D, 0x22, 0x73, 0x75, 0x62, 0x6D, 0x69, 0x74, 0x46, 0x6F, 0x72, 0x6D, 0x28,
    0x65, 0x76, 0x65, 0x6E, 0x74, 0x29, 0x22, 0x3E, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x4E, 0x65, 0x77, 0x20, 0x53, 0x53, 0x49, 0x44, 0x3A, 0x20, 0x3C, 0x69,
    0x6E, 0x70, 0x75, 0x74, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3D, 0x22, 0x74, 0x65, 0x78, 0x74,
    0x22, 0x20, 0x6E, 0x61, 0x6D, 0x65, 0x3D, 0x22, 0x73, 0x73, 0x69, 0x64, 0x22, 0x3E, 0x3C,
    0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x50, 0x61,
    0x73, 0x73, 0x77, 0x6F, 0x72, 0x64, 0x3A, 0x20, 0x3C, 0x69, 0x6E, 0x70, 0x75, 0x74, 0x20,
    0x74, 0x79, 0x70, 0x65, 0x3D, 0x22, 0x70, 0x61, 0x73, 0x73, 0x77, 0x6F, 0x72, 0x64, 0x22,
    0x20, 0x6E, 0x61, 0x6D, 0x65, 0x3D, 0x22, 0x70, 0x61, 0x73, 0x73, 0x77, 0x6F, 0x72, 0x64,
    0x22, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x41, 0x63, 0x63, 0x65, 0x73, 0x73, 0x20, 0x6B, 0x65, 0x79, 0x3A, 0x20, 0x3C, 0x69,
    0x6E, 0x70, 0x75, 0x74, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3D, 0x22, 0x70, 0x61, 0x73, 0x73,
    0x77, 0x6F, 0x72, 0x64, 0x22, 0x20, 0x6E, 0x61, 0x6D, 0x65, 0x3D, 0x22, 0x61, 0x63, 0x63,
    0x65, 0x73, 0x73, 0x5F, 0x6B, 0x65, 0x79, 0x22, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x3C, 0x69, 0x6E, 0x70, 0x75, 0x74, 0x20,
    0x74, 0x79, 0x70, 0x65, 0x3D, 0x22, 0x73, 0x75, 0x62, 0x6D, 0x69, 0x74, 0x22, 0x20, 0x76,
    0x61, 0x6C, 0x75, 0x65, 0x3D, 0x22, 0x53, 0x75, 0x62, 0x6D, 0x69, 0x74, 0x22, 0x3E, 0x0D,
    0x0A, 0x20, 0x20, 0x20, 0x20, 0x3C, 0x2F, 0x66, 0x6F, 0x72, 0x6D, 0x3E, 0x0D, 0x0A, 0x20,
    0x20, 0x20, 0x20, 0x3C, 0x64, 0x69, 0x76, 0x20, 0x69, 0x64, 0x3D, 0x22, 0x6D, 0x65, 0x73,
    0x73, 0x61, 0x67, 0x65, 0x22, 0x3E, 0x3C, 0x2F, 0x64, 0x69, 0x76, 0x3E, 0x0D, 0x0A, 0x20,
    0x20, 0x20, 0x20, 0x3C, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74, 0x3E, 0x0D, 0x0A, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x66, 0x75, 0x6E, 0x63, 0x74, 0x69, 0x6F, 0x6E, 0x20,
    0x73, 0x75, 0x62, 0x6D, 0x69, 0x74, 0x46, 0x6F, 0x72, 0x6D, 0x28, 0x65, 0x76, 0x65, 0x6E,
    0x74, 0x29, 0x20, 0x7B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x65, 0x76, 0x65, 0x6E, 0x74, 0x2E, 0x70, 0x72, 0x65, 0x76, 0x65, 0x6E,
    0x74, 0x44, 0x65, 0x66, 0x61, 0x75, 0x6C, 0x74, 0x28, 0x29, 0x3B, 0x0D, 0x0A, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x63, 0x6F, 0x6E, 0x73, 0x74,
    0x20, 0x73, 0x73, 0x69, 0x64, 0x20, 0x3D, 0x20, 0x64, 0x6F, 0x63, 0x75, 0x6D, 0x65, 0x6E,
    0x74, 0x2E, 0x67, 0x65, 0x74, 0x45, 0x6C, 0x65, 0x6D, 0x65, 0x6E, 0x74, 0x73, 0x42, 0x79,
    0x4E, 0x61, 0x6D, 0x65, 0x28, 0x27, 0x73, 0x73, 0x69, 0x64, 0x27, 0x29, 0x5B, 0x30, 0x5D,
    0x2E, 0x76, 0x61, 0x6C, 0x75, 0x65, 0x3B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x63, 0x6F, 0x6E, 0x73, 0x74, 0x20, 0x70, 0x61, 0x73,
    0x73, 0x77, 0x6F, 0x72, 0x64, 0x20, 0x3D, 0x20, 0x64, 0x6F, 0x63, 0x75, 0x6D, 0x65, 0x6E,
    0x74, 0x2E, 0x67, 0x65, 0x74, 0x45, 0x6C, 0x65, 0x6D, 0x65, 0x6E, 0x74, 0x73, 0x42, 0x79,
    0x4E, 0x61, 0x6D, 0x65, 0x28, 0x27, 0x70, 0x61, 0x73, 0x73, 0x77, 0x6F, 0x72, 0x64, 0x27,
    0x29, 0x5B, 0x30, 0x5D, 0x2E, 0x76, 0x61, 0x6C, 0x75, 0x65, 0x3B, 0x0D, 0x0A, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x63, 0x6F, 0x6E, 0x73, 0x74,
    0x20, 0x61, 0x63, 0x63, 0x65, 0x73, 0x73, 0x5F, 0x6B, 0x65, 0x79, 0x20, 0x3D, 0x20, 0x64,
    0x6F, 0x63, 0x75, 0x6D, 0x65, 0x6E, 0x74, 0x2E, 0x67, 0x65, 0x74, 0x45, 0x6C, 0x65, 0x6D,
    0x65, 0x6E, 0x74, 0x73, 0x42, 0x79, 0x4E, 0x61, 0x6D, 0x65, 0x28, 0x27, 0x61, 0x63, 0x63,
    0x65, 0x73, 0x73, 0x5F, 0x6B, 0x65, 0x79, 0x27, 0x29, 0x5B, 0x30, 0x5D, 0x2E, 0x76, 0x61,
    0x6C, 0x75, 0x65, 0x3B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x63, 0x6F, 0x6E, 0x73, 0x74, 0x20, 0x6D, 0x65, 0x73, 0x73, 0x61, 0x67,
    0x65, 0x45, 0x6C, 0x65, 0x6D, 0x65, 0x6E, 0x74, 0x20, 0x3D, 0x20, 0x64, 0x6F, 0x63, 0x75,
    0x6D, 0x65, 0x6E, 0x74, 0x2E, 0x67, 0x65, 0x74, 0x45, 0x6C, 0x65, 0x6D, 0x65, 0x6E, 0x74,
    0x42, 0x79, 0x49, 0x64, 0x28, 0x27, 0x6D, 0x65, 0x73, 0x73, 0x61, 0x67, 0x65, 0x27, 0x29,
    0x3B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x66, 0x65, 0x74, 0x63, 0x68, 0x28, 0x27, 0x2F, 0x6C, 0x6F, 0x67, 0x69, 0x6E, 0x3F, 0x73,
    0x73, 0x69, 0x64, 0x3D, 0x27, 0x20, 0x2B, 0x20, 0x65, 0x6E, 0x63, 0x6F, 0x64, 0x65, 0x55,
    0x52, 0x49, 0x43, 0x6F, 0x6D, 0x70, 0x6F, 0x6E, 0x65, 0x6E, 0x74, 0x28, 0x73, 0x73, 0x69,
    0x64, 0x29, 0x20, 0x2B, 0x20, 0x27, 0x26, 0x70, 0x61, 0x73, 0x73, 0x77, 0x6F, 0x72, 0x64,
    0x3D, 0x27, 0x20, 0x2B, 0x20, 0x65, 0x6E, 0x63, 0x6F, 0x64, 0x65, 0x55, 0x52, 0x49, 0x43,
    0x6F, 0x6D, 0x70, 0x6F, 0x6E, 0x65, 0x6E, 0x74, 0x28, 0x70, 0x61, 0x73, 0x73, 0x77, 0x6F,
    0x72, 0x64, 0x29, 0x20, 0x2B, 0x20, 0x27, 0x26, 0x61, 0x63, 0x63, 0x65, 0x73, 0x73, 0x5F,
    0x6B, 0x65, 0x79, 0x3D, 0x27, 0x20, 0x2B, 0x20, 0x65, 0x6E, 0x63, 0x6F, 0x64, 0x65, 0x55,
    0x52, 0x49, 0x43, 0x6F, 0x6D, 0x70, 0x6F, 0x6E, 0x65, 0x6E, 0x74, 0x28, 0x61, 0x63, 0x63,
    0x65, 0x73, 0x73, 0x5F, 0x6B, 0x65, 0x79, 0x29, 0x29, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x2E, 0x74, 0x68,
    0x65, 0x6E, 0x28, 0x72, 0x65, 0x73, 0x70, 0x6F, 0x6E, 0x73, 0x65, 0x20, 0x3D, 0x3E, 0x20,
    0x7B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x69, 0x66, 0x20, 0x28, 0x72, 0x65, 0x73,
    0x70, 0x6F, 0x6E, 0x73, 0x65, 0x2E, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20, 0x3D, 0x3D,
    0x3D, 0x20, 0x32, 0x30, 0x30, 0x29, 0x20, 0x7B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x6D, 0x65, 0x73, 0x73, 0x61, 0x67, 0x65, 0x45, 0x6C, 0x65, 0x6D,
    0x65, 0x6E, 0x74, 0x2E, 0x69, 0x6E, 0x6E, 0x65, 0x72, 0x48, 0x54, 0x4D, 0x4C, 0x20, 0x3D,
    0x20, 0x27, 0x44, 0x61, 0x74, 0x61, 0x20, 0x61, 0x70, 0x70, 0x6C, 0x69, 0x65, 0x64, 0x20,
    0x73, 0x75, 0x63, 0x63, 0x65, 0x73, 0x73, 0x66, 0x75, 0x6C, 0x6C, 0x79, 0x2E, 0x27, 0x3B,
    0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x6D, 0x65, 0x73, 0x73,
    0x61, 0x67, 0x65, 0x45, 0x6C, 0x65, 0x6D, 0x65, 0x6E, 0x74, 0x2E, 0x73, 0x74, 0x79, 0x6C,
    0x65, 0x2E, 0x62, 0x61, 0x63, 0x6B, 0x67, 0x72, 0x6F, 0x75, 0x6E, 0x64, 0x43, 0x6F, 0x6C,
    0x6F, 0x72, 0x20, 0x3D, 0x20, 0x27, 0x67, 0x72, 0x65, 0x65, 0x6E, 0x27, 0x3B, 0x0D, 0x0A,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x54, 0x69, 0x6D,
    0x65, 0x6F, 0x75, 0x74, 0x28, 0x66, 0x75, 0x6E, 0x63, 0x74, 0x69, 0x6F, 0x6E, 0x20, 0x28,
    0x29, 0x20, 0x7B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x6D, 0x65, 0x73, 0x73, 0x61, 0x67, 0x65, 0x45, 0x6C, 0x65, 0x6D, 0x65,
    0x6E, 0x74, 0x2E, 0x69, 0x6E, 0x6E, 0x65, 0x72, 0x48, 0x54, 0x4D, 0x4C, 0x20, 0x3D, 0x20,
    0x27, 0x27, 0x3B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x7D,
    0x2C, 0x20, 0x33, 0x30, 0x30, 0x30, 0x29, 0x3B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x7D, 0x20, 0x65, 0x6C, 0x73, 0x65, 0x20, 0x69, 0x66, 0x20, 0x28, 0x72, 0x65, 0x73, 0x70,
    0x6F, 0x6E, 0x73, 0x65, 0x2E, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20, 0x3D, 0x3D, 0x3D,
    0x20, 0x34, 0x30, 0x33, 0x29, 0x20, 0x7B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x6D, 0x65, 0x73, 0x73, 0x61, 0x67, 0x65, 0x45, 0x6C, 0x65, 0x6D, 0x65,
    0x6E, 0x74, 0x2E, 0x69, 0x6E, 0x6E, 0x65, 0x72, 0x48, 0x54, 0x4D, 0x4C, 0x20, 0x3D, 0x20,
    0x27, 0x54, 0x68, 0x65, 0x20, 0x6B, 0x65, 0x79, 0x20, 0x69, 0x73, 0x20, 0x69, 0x6E, 0x63,
    0x6F, 0x72, 0x72, 0x65, 0x63, 0x74, 0x27, 0x3B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x6D, 0x65, 0x73, 0x73, 0x61, 0x67, 0x65, 0x45, 0x6C, 0x65, 0x6D,
    0x65, 0x6E, 0x74, 0x2E, 0x73, 0x74, 0x79, 0x6C, 0x65, 0x2E, 0x62, 0x61, 0x63, 0x6B, 0x67,
    0x72, 0x6F, 0x75, 0x6E, 0x64, 0x43, 0x6F, 0x6C, 0x6F, 0x72, 0x20, 0x3D, 0x20, 0x27, 0x72,
    0x65, 0x64, 0x27, 0x3B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x73, 0x65, 0x74, 0x54, 0x69, 0x6D, 0x65, 0x6F, 0x75, 0x74, 0x28, 0x66, 0x75, 0x6E, 0x63,
    0x74, 0x69, 0x6F, 0x6E, 0x20, 0x28, 0x29, 0x20, 0x7B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x6D, 0x65, 0x73, 0x73, 0x61, 0x67,
    0x65, 0x45, 0x6C, 0x65, 0x6D, 0x65, 0x6E, 0x74, 0x2E, 0x69, 0x6E, 0x6E, 0x65, 0x72, 0x48,
    0x54, 0x4D, 0x4C, 0x20, 0x3D, 0x20, 0x27, 0x27, 0x3B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x7D, 0x2C, 0x20, 0x33, 0x30, 0x30, 0x30, 0x29, 0x3B, 0x0D,
    0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x7D, 0x20, 0x65, 0x6C, 0x73, 0x65, 0x20, 0x7B, 0x0D,
    0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x64, 0x6F, 0x63, 0x75, 0x6D,
    0x65, 0x6E, 0x74, 0x2E, 0x67, 0x65, 0x74, 0x45, 0x6C, 0x65, 0x6D, 0x65, 0x6E, 0x74, 0x42,
    0x79, 0x49, 0x64, 0x28, 0x27, 0x6D, 0x65, 0x73, 0x73, 0x61, 0x67, 0x65, 0x27, 0x29, 0x2E,
    0x69, 0x6E, 0x6E, 0x65, 0x72, 0x48, 0x54, 0x4D, 0x4C, 0x20, 0x3D, 0x20, 0x27, 0x44, 0x61,
    0x74, 0x61, 0x20, 0x6E, 0x6F, 0x74, 0x20, 0x61, 0x70, 0x70, 0x6C, 0x69, 0x65, 0x64, 0x27,
    0x3B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x6D, 0x65, 0x73,
    0x73, 0x61, 0x67, 0x65, 0x45, 0x6C, 0x65, 0x6D, 0x65, 0x6E, 0x74, 0x2E, 0x73, 0x74, 0x79,
    0x6C, 0x65, 0x2E, 0x62, 0x61, 0x63, 0x6B, 0x67, 0x72, 0x6F, 0x75, 0x6E, 0x64, 0x43, 0x6F,
    0x6C, 0x6F, 0x72, 0x20, 0x3D, 0x20, 0x27, 0x72, 0x65, 0x64, 0x27, 0x3B, 0x0D, 0x0A, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x54, 0x69, 0x6D, 0x65,
    0x6F, 0x75, 0x74, 0x28, 0x66, 0x75, 0x6E, 0x63, 0x74, 0x69, 0x6F, 0x6E, 0x20, 0x28, 0x29,
    0x20, 0x7B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x6D, 0x65, 0x73, 0x73, 0x61, 0x67, 0x65, 0x45, 0x6C, 0x65, 0x6D, 0x65, 0x6E,
    0x74, 0x2E, 0x69, 0x6E, 0x6E, 0x65, 0x72, 0x48, 0x54, 0x4D, 0x4C, 0x20, 0x3D, 0x20, 0x27,
    0x27, 0x3B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x7D, 0x2C,
    0x20, 0x33, 0x30, 0x30, 0x30, 0x29, 0x3B, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x7D,
    0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x7D, 0x29, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x7D, 0x0D, 0x0A, 0x20, 0x20, 0x20, 0x20, 0x3C, 0x2F, 0x73, 0x63, 0x72,
    0x69, 0x70, 0x74, 0x3E, 0x0D, 0x0A, 0x3C, 0x2F, 0x62, 0x6F, 0x64, 0x79, 0x3E, 0x0D, 0x0A,
    0x3C, 0x2F, 0x68, 0x74, 0x6D, 0x6C, 0x3E,
};


static esp_err_t root_handler(httpd_req_t *req)
{
    if (req->method == HTTP_GET)
    {
        httpd_resp_sendstr(req, index_html);
        ESP_LOGI(TAG, "GET / HTTP successful");
        return ESP_OK;
    }
    ESP_LOGE(TAG, "GET / HTTP failed");
    return httpd_resp_send_404(req);
}

static esp_err_t login_handler(httpd_req_t *req)
{
    char buf[2048];
    memset(buf, 0, sizeof(buf));
    if (req->method == HTTP_GET)
    {
        size_t buf_len = httpd_req_get_url_query_len(req) + 1;
        if (buf_len > 1)
        {
            char* buf = malloc(buf_len);
            if (buf)
            {
                if (httpd_req_get_url_query_str(req, buf, buf_len) == ESP_OK)
                {
                    ESP_LOGI(TAG, "parsing query string");
                    char param[64];
                    if (httpd_query_key_value(buf, "access_key", param, sizeof(param)) == ESP_OK)
                    {
                        if (strcmp(param, access_key) != 0) {
                            // httpd_resp_set_status(req, HTTPD_403_FORBIDDEN);
                            httpd_resp_send_err(req, HTTPD_403_FORBIDDEN, NULL);
                            free(buf);
                            ESP_LOGI(TAG, "handler /login 403");
                            return ESP_OK;
                        }
                    }
                    if (httpd_query_key_value(buf, "ssid", param, sizeof(param)) == ESP_OK)
                    {
                        if (strlen(param) != 0) {
                            strncpy(ssid, param, sizeof(ssid) - 1);
                        }
                    }
                    if (httpd_query_key_value(buf, "password", param, sizeof(param)) == ESP_OK)
                    {
                        strncpy(password, param, sizeof(password) - 1);
                    }
                    ESP_LOGI(TAG, "Received ssid: %s, password: %s", ssid, password);
                    ESP_LOGI(TAG, "GET /login HTTP 200");
                    free(buf);
                    httpd_resp_send(req, NULL, 0);
                    return ESP_OK;
                }
                free(buf);
            }
        }
     }
    ESP_LOGE(TAG, "GET /login HTTP 400");
    httpd_resp_send_err(req, HTTPD_400_BAD_REQUEST, NULL);
    // httpd_resp_set_status(req, HTTPD_400_BAD_REQUEST);
    // TODO: это ответ 400?
    return ESP_FAIL;
}

httpd_uri_t root = {
    .uri = "/",
    .method = HTTP_GET,
    .handler = root_handler,
    .user_ctx = NULL};

httpd_uri_t login_uri = {
    .uri = "/login",
    .method = HTTP_GET,
    .handler = login_handler,
    .user_ctx = NULL};

httpd_handle_t start_http_server()
{
    httpd_config_t config = HTTPD_DEFAULT_CONFIG();
    config.stack_size = 8192;
    config.server_port = 80;

    ESP_ERROR_CHECK(httpd_start(&server, &config));
    ESP_ERROR_CHECK(httpd_register_uri_handler(server, &root));
    ESP_ERROR_CHECK(httpd_register_uri_handler(server, &login_uri));

    xEventGroupSetBits(net_event_group, HTTP_STARTED);

    ESP_LOGI(TAG, "HTTP server started");

    return server;
}